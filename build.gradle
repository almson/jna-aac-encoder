plugins {
    id 'java'
    id 'jacoco'
    id 'org.junit.platform.gradle.plugin' version '1.1.0'
    id 'com.github.kt3k.coveralls' version '2.8.2'
}

apply from: 'common.gradle'

junitPlatform {
    details 'tree'

    filters {
        includeClassNamePattern '.*Test'
    }
}

jacoco {
    toolVersion = '0.8.0'
    applyTo junitPlatformTest
}

jacocoTestReport {
    reports {
        html.enabled = false
        xml.enabled = true
        xml.destination file("${buildDir}/reports/jacoco/test/jacocoTestReport.xml")
    }
}

junitPlatformTest {
    jacoco {
        destinationFile = file("$buildDir/jacoco/test.exec")
    }
}

afterEvaluate {
    def task = tasks.getByName('junitPlatformTest')
    def libPath = project.hasProperty('libPath') ? project.properties['libPath'] : System.properties['java.library.path']
    task.systemProperty "jna.library.path", libPath
}